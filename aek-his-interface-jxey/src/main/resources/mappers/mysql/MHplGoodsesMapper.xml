<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<!--
物资基础数据。操作相关SQL Mapper
@author Lanpz
@date 2016-12-15
@source Generated by MySQL2Java
-->

<!-- 此命名空间必须和对应Mapper.java文件的命名空间一致 -->
<mapper namespace="com.aek.persistence.mysql.mapper.MHplGoodsesMapper">

    <!-- 物资基础数据。栏位列表 -->
    <resultMap id="rm" type="com.aek.persistence.oracle.beans.BdHplGoodses">
        <result property="areaId" jdbcType="INTEGER" column="area_id" />
        <result property="sysId" jdbcType="BIGINT" column="sys_id" />
        <result property="classId" jdbcType="BIGINT" column="class_id" />
        <result property="className" jdbcType="VARCHAR" column="class_name" />
        <result property="goodsId" jdbcType="BIGINT" column="goods_id" />
        <result property="typeId" jdbcType="VARCHAR" column="type_id" />
        <result property="typeName" jdbcType="VARCHAR" column="type_name" />
        <result property="goodsGuid" jdbcType="VARCHAR" column="goods_guid" />
        <result property="goodsType" jdbcType="INTEGER" column="goods_type" />
        <result property="goodsNo" jdbcType="VARCHAR" column="goods_no" />
        <result property="goodsName" jdbcType="VARCHAR" column="goods_name" />
        <result property="goodsNamePy" jdbcType="VARCHAR" column="goods_name_py" />
        <result property="goodsNameWb" jdbcType="VARCHAR" column="goods_name_wb" />
        <result property="goodsAccountTypeId" jdbcType="BIGINT" column="goods_account_type_id" />
        <result property="goodsAccountName" jdbcType="VARCHAR" column="goods_account_name" />
        <result property="goodsCalcTypeId" jdbcType="BIGINT" column="goods_calc_type_id" />
        <result property="goodsCalcName" jdbcType="VARCHAR" column="goods_calc_name" />
        <result property="goodsStandardTypeId" jdbcType="VARCHAR" column="goods_standard_type_id" />
        <result property="goodsStandardName" jdbcType="VARCHAR" column="goods_standard_name" />
        <result property="goodsManagementFlag" jdbcType="VARCHAR" column="goods_management_flag" />
        <result property="facId" jdbcType="BIGINT" column="fac_id" />
        <result property="facName" jdbcType="VARCHAR" column="fac_name"/>
        <result property="factoryAddr" jdbcType="VARCHAR" column="factory_addr" />
        <result property="brandId" jdbcType="BIGINT" column="brand_id" />
        <result property="brandName" jdbcType="VARCHAR" column="brand_name"/>
        <result property="regId" jdbcType="BIGINT" column="reg_id" />
        <result property="regNo" jdbcType="VARCHAR" column="reg_no"/>
        <result property="goodsMaterialId" jdbcType="BIGINT" column="goods_material_id" />
        <result property="goodsMaterialName" jdbcType="VARCHAR" column="goods_material_name" />
        <result property="goodsSterilizeId" jdbcType="BIGINT" column="goods_sterilize_id" />
        <result property="goodsSterilizeName" jdbcType="VARCHAR" column="goods_sterilize_name" />
        <result property="medicareFlag" jdbcType="INTEGER" column="medicare_flag" />
        <result property="repeatFlag" jdbcType="INTEGER" column="repeat_flag" />
        <result property="sourceFlag" jdbcType="INTEGER" column="source_flag" />
        <result property="addBy" jdbcType="BIGINT" column="add_by" />
        <result property="addName" jdbcType="VARCHAR" column="add_name" />
        <result property="addTime" jdbcType="VARCHAR" column="add_time_format" />
        <result property="lastEditBy" jdbcType="BIGINT" column="last_edit_by" />
        <result property="lastEditName" jdbcType="VARCHAR" column="last_edit_name" />
        <result property="lastEditTime" jdbcType="VARCHAR" column="last_time_format" />
        <result property="delFlag" jdbcType="INTEGER" column="del_flag" />
    </resultMap>

    <!-- 获取物资基础数据。 -->
    <select id="getGoodsList" resultMap="rm" parameterType="java.util.Map">
        SELECT goods.*, 
               reg.reg_no, 
               brand.bra_name AS brand_name, 
               fac.fac_name,
               type.type_name,
               material.code_text AS goods_material_name,
               sterilize.code_text AS goods_sterilize_name,
               DATE_FORMAT(goods.add_time,'%Y-%m-%d %T') AS add_time_format,
               DATE_FORMAT(goods.last_edit_time,'%Y-%m-%d %T') AS last_time_format
          FROM herp.bd_hpl_goodses goods
          LEFT JOIN herp.base_goods_reg reg ON goods.reg_id = reg.reg_id
          LEFT JOIN herp.base_factory_brand brand ON goods.brand_id = brand.bra_id
          LEFT JOIN herp.base_factory_info fac ON goods.fac_id = fac.fac_id
          LEFT JOIN herp.bd_hpl_goods_types type ON goods.type_id=type.type_id
          LEFT JOIN herp.bd_hpl_code_info material ON goods.goods_material_id=material.code_id
          LEFT JOIN herp.bd_hpl_code_info sterilize ON goods.goods_sterilize_id=sterilize.code_id
        <if test="null != dateFlag and 1 == dateFlag">
            WHERE IFNULL(DATE_FORMAT(goods.last_edit_time,'%Y-%m-%d'),DATE_FORMAT(goods.add_time,'%Y-%m-%d')) = DATE_FORMAT(SYSDATE(),'%Y-%m-%d')
        </if>
         GROUP BY goods_id
         LIMIT #{begin}, #{end}
    </select>

</mapper>
