<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<!--
库房正常出库记录。操作相关SQL Mapper
@author Lanpz
@date 2016-12-20
@source Generated by MySQL2Java
-->

<!-- 此命名空间必须和对应Mapper.java文件的命名空间一致 -->
<mapper namespace="com.aek.persistence.mysql.mapper.MSdHplStockOutMapper">

    <!-- 库房正常出库记录。栏位列表 -->
    <resultMap id="rm" type="com.aek.persistence.oracle.beans.SdHplStockOut">
        <result property="formId" jdbcType="BIGINT" column="form_id" />
        <result property="formNo" jdbcType="BIGINT" column="form_no" />
        <result property="outType" jdbcType="INTEGER" column="out_type" />
        <result property="stockFlag" jdbcType="INTEGER" column="stock_flag" />
        <result property="areaId" jdbcType="INTEGER" column="area_id" />
        <result property="sysId" jdbcType="BIGINT" column="sys_id" />
        <result property="periodNo" jdbcType="INTEGER" column="period_no" />
        <result property="whOutId" jdbcType="BIGINT" column="wh_out_id" />
        <result property="whOutName" jdbcType="VARCHAR" column="wh_out_name"/>
        <result property="whId" jdbcType="BIGINT" column="wh_id" />
        <result property="whName" jdbcType="VARCHAR" column="wh_name"/>
        <result property="whSiteId" jdbcType="BIGINT" column="wh_site_id" />
        <result property="deptId" jdbcType="BIGINT" column="dept_id" />
        <result property="deptNo" jdbcType="VARCHAR" column="dept_no"/>
        <result property="deptName" jdbcType="VARCHAR" column="dept_name"/>
        <result property="accountType" jdbcType="BIGINT" column="account_type" />
        <result property="accountTypeStr" jdbcType="VARCHAR" column="account_type_str"/>
        <result property="calcType" jdbcType="BIGINT" column="calc_type" />
        <result property="calcTypeStr" jdbcType="VARCHAR" column="calc_type_str"/>
        <result property="fundsSource" jdbcType="BIGINT" column="funds_source" />
        <result property="fundsSourceStr" jdbcType="VARCHAR" column="funds_source_str"/>
        <result property="requestUser" jdbcType="BIGINT" column="request_user" />
        <result property="originalForm" jdbcType="BIGINT" column="original_form" />
        <result property="receiverType" jdbcType="INTEGER" column="receiver_type" />
        <result property="receiverNote" jdbcType="VARCHAR" column="receiver_note" />
        <result property="receiverName" jdbcType="VARCHAR" column="receiver_name" />
        <result property="receiverAddr" jdbcType="VARCHAR" column="receiver_addr" />
        <result property="receiverPhone" jdbcType="VARCHAR" column="receiver_phone" />
        <result property="formQty" jdbcType="INTEGER" column="form_qty" />
        <result property="formAmount" jdbcType="VARCHAR" column="form_amount" />
        <result property="outAmount" jdbcType="VARCHAR" column="out_amount" />
        <result property="formStatus" jdbcType="INTEGER" column="form_status" />
        <result property="formRemark" jdbcType="VARCHAR" column="form_remark" />
        <result property="printTimes" jdbcType="INTEGER" column="print_times" />
        <result property="redTimes" jdbcType="INTEGER" column="red_times" />
        <result property="redFlag" jdbcType="INTEGER" column="red_flag" />
        <result property="redFormId" jdbcType="BIGINT" column="red_form_id" />
        <result property="stockInFormId" jdbcType="BIGINT" column="stock_in_form_id" />
        <result property="submitBy" jdbcType="BIGINT" column="submit_by" />
        <result property="submitName" jdbcType="VARCHAR" column="submit_name" />
        <result property="submitTime" jdbcType="VARCHAR" column="submit_time_format" />
        <result property="approveBy" jdbcType="BIGINT" column="approve_by" />
        <result property="approveName" jdbcType="VARCHAR" column="approve_name" />
        <result property="approveTime" jdbcType="VARCHAR" column="approve_time_format" />
        <result property="accountBy" jdbcType="BIGINT" column="account_by" />
        <result property="accountName" jdbcType="VARCHAR" column="account_name" />
        <result property="accountTime" jdbcType="VARCHAR" column="account_time_format" />
        <result property="addBy" jdbcType="BIGINT" column="add_by" />
        <result property="addName" jdbcType="VARCHAR" column="add_name" />
        <result property="addTime" jdbcType="VARCHAR" column="add_time_format"/>
        <result property="lastEditBy" jdbcType="BIGINT" column="last_edit_by" />
        <result property="lastEditName" jdbcType="VARCHAR" column="last_edit_name" />
        <result property="lastEditTime" jdbcType="VARCHAR" column="last_edit_time_format" />
        <result property="deptRoomId" jdbcType="BIGINT" column="dept_room_id" />
        <result property="inpatientNo" jdbcType="VARCHAR" column="inpatient_no" />
        <result property="patientName" jdbcType="VARCHAR" column="patient_name" />
        <result property="bedNo" jdbcType="VARCHAR" column="bed_no" />
        <result property="deptRoomName" jdbcType="VARCHAR" column="dept_room_name" />
    </resultMap>

    <!-- 获取库房正常出库记录。 -->
    <select id="getOutList" resultMap="rm" parameterType="java.util.Map">
        SELECT outs.*, dept.his_dept_no AS dept_no,
               dept.dept_name,
               wh.wh_name,
               whout.wh_name AS wh_out_name,
               site.wh_site_name,
               date_format(outs.add_time, '%Y-%m-%d %T') AS add_time_format,
               date_format(outs.last_edit_time, '%Y-%m-%d %T') AS last_edit_time_format,
               date_format(outs.submit_time, '%Y-%m-%d %T') AS submit_time_format,
               date_format(outs.approve_time, '%Y-%m-%d %T') AS approve_time_format,
               date_format(outs.account_time, '%Y-%m-%d %T') AS account_time_format, 
               account.code_text AS account_type_str,
               calc.code_text AS calc_type_str,
               funds.code_text AS funds_source_str
          FROM herp.sd_hpl_stock_out outs
          LEFT JOIN herp.pm_hpl_dept_info dept ON outs.dept_id = dept.dept_id
          LEFT JOIN herp.pm_hpl_wh_info wh ON wh.wh_id = outs.wh_id
          LEFT JOIN herp.pm_hpl_wh_info whout ON whout.wh_id = outs.wh_out_id
          LEFT JOIN herp.pm_hpl_wh_site site ON outs.wh_site_id = site.wh_site_id
          LEFT JOIN herp.bd_hpl_code_info account ON outs.account_type=account.code_id
          LEFT JOIN herp.bd_hpl_code_info calc ON outs.calc_type=calc.code_id
          LEFT JOIN herp.bd_hpl_code_info funds ON outs.funds_source=funds.code_id
         WHERE outs.stock_flag = 0 AND outs.form_status = 3
         <if test="null != dateFlag and 1 == dateFlag">
           AND ifnull(date_format(outs.last_edit_time,'%Y-%m-%d'),date_format(outs.add_time,'%Y-%m-%d')) = date_format(SYSDATE(),'%Y-%m-%d') 
         </if>
         LIMIT #{begin}, #{end}
    </select>

</mapper>
