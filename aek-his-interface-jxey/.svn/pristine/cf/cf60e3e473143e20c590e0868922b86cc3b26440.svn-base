<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<!--
库房出库明细。操作相关SQL Mapper
@author Lanpz
@date 2016-12-20
@source Generated by MySQL2Java
-->

<!-- 此命名空间必须和对应Mapper.java文件的命名空间一致 -->
<mapper namespace="com.aek.persistence.mysql.mapper.MSdHplStockOutItemsMapper">

    <!-- 库房出库明细。栏位列表 -->
    <resultMap id="rm" type="com.aek.persistence.oracle.beans.SdHplStockOutItems">
        <result property="itemId" jdbcType="BIGINT" column="item_id" />
        <result property="areaId" jdbcType="INTEGER" column="area_id" />
        <result property="sysId" jdbcType="BIGINT" column="sys_id" />
        <result property="whId" jdbcType="BIGINT" column="wh_id" />
        <result property="whName" jdbcType="VARCHAR" column="wh_name"/>
        <result property="whSiteId" jdbcType="BIGINT" column="wh_site_id" />
        <result property="whSiteName" jdbcType="VARCHAR" column="wh_site_name"/>
        <result property="formId" jdbcType="BIGINT" column="form_id" />
        <result property="itemIndex" jdbcType="INTEGER" column="item_index" />
        <result property="exchangeId" jdbcType="BIGINT" column="exchange_id" />
        <result property="specId" jdbcType="BIGINT" column="spec_id" />
        <result property="specModel" jdbcType="VARCHAR" column="spec_model"/>
        <result property="goodsName" jdbcType="VARCHAR" column="goods_name" />
        <result property="commonName" jdbcType="VARCHAR" column="common_name" />
        <result property="specSize" jdbcType="VARCHAR" column="spec_size" />
        <result property="regNo" jdbcType="VARCHAR" column="reg_no" />
        <result property="specUnit" jdbcType="VARCHAR" column="spec_unit" />
        <result property="unitPrice" jdbcType="DOUBLE" column="unit_price" />
        <result property="specPackage" jdbcType="VARCHAR" column="spec_package" />
        <result property="splId" jdbcType="BIGINT" column="spl_id" />
        <result property="splName" jdbcType="VARCHAR" column="spl_name"/>
        <result property="facId" jdbcType="BIGINT" column="fac_id" />
        <result property="facName" jdbcType="VARCHAR" column="fac_name"/>
        <result property="factoryAddr" jdbcType="VARCHAR" column="factory_addr" />
        <result property="specBrand" jdbcType="VARCHAR" column="spec_brand" />
        <result property="stockOutQty" jdbcType="INTEGER" column="stock_out_qty" />
        <result property="stockPrice" jdbcType="DOUBLE" column="stock_price" />
        <result property="stockGiftQty" jdbcType="INTEGER" column="stock_gift_qty" />
        <result property="stockReturnQty" jdbcType="INTEGER" column="stock_return_qty" />
        <result property="stockOldQty" jdbcType="INTEGER" column="stock_old_qty" />
        <result property="stockAmount" jdbcType="DOUBLE" column="stock_amount" />
        <result property="specBarcodeType" jdbcType="BIGINT" column="spec_barcode_type" />
        <result property="barcodeId" jdbcType="BIGINT" column="barcode_id" />
        <result property="barcodeStr" jdbcType="VARCHAR" column="barcode_str" />
        <result property="batchNo" jdbcType="VARCHAR" column="batch_no" />
        <result property="productDate" jdbcType="VARCHAR" column="product_date_format" />
        <result property="expiredDate" jdbcType="VARCHAR" column="expired_date_format" />
        <result property="sterilizeNo" jdbcType="VARCHAR" column="sterilize_no" />
        <result property="sterilizeDate" jdbcType="VARCHAR" column="sterilize_date_format" />
        <result property="lockFlag" jdbcType="INTEGER" column="lock_flag" />
        <result property="reqItemId" jdbcType="INTEGER" column="req_item_id" />
        <result property="stockCheckReason" jdbcType="VARCHAR" column="stock_check_reason" />
        <result property="redItemId" jdbcType="BIGINT" column="red_item_id" />
        <result property="addBy" jdbcType="BIGINT" column="add_by" />
        <result property="addName" jdbcType="VARCHAR" column="add_name" />
        <result property="addTime" jdbcType="VARCHAR" column="add_time_format"/>
        <result property="lastEditBy" jdbcType="BIGINT" column="last_edit_by" />
        <result property="lastEditName" jdbcType="VARCHAR" column="last_edit_name" />
        <result property="lastEditTime" jdbcType="VARCHAR" column="last_edit_time_format" />
        <result property="curId" jdbcType="BIGINT" column="cur_id" />
        <result property="accountType" jdbcType="BIGINT" column="account_type" />
        <result property="calcType" jdbcType="BIGINT" column="calc_type" />
        <result property="stockRedQty" jdbcType="INTEGER" column="stock_red_qty" />
        <result property="stockAccQty" jdbcType="INTEGER" column="stock_acc_qty" />
        <result property="stockBudgetQty" jdbcType="INTEGER" column="stock_budget_qty" />
        <result property="stockCancelQty" jdbcType="INTEGER" column="stock_cancel_qty" />
        <result property="stockBackQty" jdbcType="INTEGER" column="stock_back_qty" />
        <result property="accItemId" jdbcType="BIGINT" column="acc_item_id" />
        <result property="budgetItemId" jdbcType="BIGINT" column="budget_item_id" />
        <result property="cancelItemId" jdbcType="BIGINT" column="cancel_item_id" />
        <result property="returnItemId" jdbcType="BIGINT" column="return_item_id" />
        <result property="backItemId" jdbcType="BIGINT" column="back_item_id" />
        <result property="delFlag" jdbcType="INTEGER" column="del_flag"/>
    </resultMap>

    <!-- 获取库房出库明细。 -->
    <select id="getItemList" resultMap="rm" parameterType="java.util.HashMap">
        SELECT item.*, fac.fac_name, spl.spl_name,spec.spec_model,wh.wh_name, site.wh_site_name,
               date_format(item.add_time,'%Y-%m-%d %T') AS add_time_format,
               date_format(item.last_edit_time,'%Y-%m-%d %T') AS last_edit_time_format,
               date_format(item.sterilize_date,'%Y-%m-%d %T') AS sterilize_date_format,
               date_format(item.expired_date,'%Y-%m-%d %T') AS expired_date_format,
               date_format(item.product_date,'%Y-%m-%d %T') AS product_date_format
          FROM herp.sd_hpl_stock_out_items item 
     LEFT JOIN herp.sd_hpl_stock_out outs ON outs.form_id = item.form_id AND outs.sys_id = item.sys_id 
     LEFT JOIN herp.base_factory_info fac ON item.fac_id = fac.fac_id 
     LEFT JOIN herp.base_suppliers spl ON item.spl_id = spl.spl_id
     LEFT JOIN herp.bd_hpl_goods_specs spec ON item.spec_id = spec.spec_id
     LEFT JOIN herp.pm_hpl_wh_info wh ON item.wh_id = wh.wh_id
     LEFT JOIN herp.pm_hpl_wh_site site ON site.wh_site_id = item.wh_site_id
         WHERE outs.stock_flag = 0 
           AND outs.form_status = 3
        <if test="null != dateFlag and 1 == dateFlag">
           AND ifnull(date_format(item.last_edit_time,'%Y-%m-%d'),date_format(item.add_time,'%Y-%m-%d')) = date_format(SYSDATE(),'%Y-%m-%d')
        </if>
         LIMIT #{begin}, #{end}
    </select>

</mapper>
